<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Technical Details &mdash; PyPEEC</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
    <link rel="shortcut icon" href="../_static/icon.png"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="File Formats" href="format.html" />
    <link rel="prev" title="Included Examples" href="examples.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #2980B9" >

          
          
          <a href="../index.html" class="icon icon-home">
            PyPEEC
              <img src="../_static/header.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                4.0.1.dev20+g32863a9
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../index.html">Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="about.html">About</a></li>
<li class="toctree-l1"><a class="reference internal" href="gallery.html">Gallery</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Included Examples</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Technical Details</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#dependencies">Dependencies</a></li>
<li class="toctree-l2"><a class="reference internal" href="#platforms">Platforms</a></li>
<li class="toctree-l2"><a class="reference internal" href="#fft-accelerated-peec-method">FFT-Accelerated PEEC Method</a></li>
<li class="toctree-l2"><a class="reference internal" href="#numerical-optimization">Numerical Optimization</a></li>
<li class="toctree-l2"><a class="reference internal" href="#configuration-file">Configuration File</a></li>
<li class="toctree-l2"><a class="reference internal" href="#packaging-and-environment">Packaging and Environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="#automated-tests">Automated Tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="#sphinx-documentation">Sphinx Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pypeec-warnings">PyPEEC Warnings</a></li>
<li class="toctree-l2"><a class="reference internal" href="#library-warnings">Library Warnings</a></li>
<li class="toctree-l2"><a class="reference internal" href="#general-warnings">General Warnings</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="format.html">File Formats</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/api.html">API</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #2980B9" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">PyPEEC</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Technical Details</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/content/technical.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="technical-details">
<h1>Technical Details<a class="headerlink" href="#technical-details" title="Permalink to this heading"></a></h1>
<section id="dependencies">
<h2>Dependencies<a class="headerlink" href="#dependencies" title="Permalink to this heading"></a></h2>
<p><strong>PyPEEC</strong> is entirely programmed in <strong>Python 3</strong> and has the following dependencies:</p>
<ul class="simple">
<li><p>PyYAML (configuration file format)</p></li>
<li><p>NumPy, SciPy, and Joblib (numerical libraries)</p></li>
<li><p>Pillow (for the mesher, image manipulation)</p></li>
<li><p>Shapely and Rasterio (for the mesher, 2D shape manipulation)</p></li>
<li><p>VTK and PyVista (for the mesher, 3D shape manipulation)</p></li>
</ul>
<p>Additionally, the following <strong>libraries</strong> are used for the <strong>plotter</strong> and <strong>viewer</strong>:</p>
<ul class="simple">
<li><p>Matplotlib and PyQt5 (2D plots)</p></li>
<li><p>VTK, PyVista, PyVistaQt, and PyQt5 (3D plots)</p></li>
</ul>
<p>The following <strong>optional packages</strong> can be used for speeding up the solver:</p>
<ul class="simple">
<li><p>UMFPACK (available through SciKits)</p></li>
<li><p>MKL/PARDISO (available through Pydiso)</p></li>
<li><p>FFTW (available through pyFFTW)</p></li>
<li><p>CuPy (using GPUs through CUDA)</p></li>
</ul>
</section>
<section id="platforms">
<h2>Platforms<a class="headerlink" href="#platforms" title="Permalink to this heading"></a></h2>
<p>The following <strong>platforms</strong> and systems have been <strong>tested</strong>:</p>
<ul class="simple">
<li><p>Linux / RedHat 7.9 on x86/x64</p></li>
<li><p>Linux / Ubuntu 20.04 on x86/x64</p></li>
<li><p>Linux / Ubuntu 22.04 on x86/x64</p></li>
<li><p>Apple / macOS Ventura 13 on M1 Pro</p></li>
<li><p>MS Windows / Pro 10 21H2 on x86/x64</p></li>
<li><p>GPU / NVIDIA T4 Tensor</p></li>
<li><p>GPU / NVIDIA Tesla K80</p></li>
</ul>
<p>The following <strong>platforms</strong> are passing the <strong>automated tests</strong>:</p>
<ul class="simple">
<li><p>Linux / Ubuntu 22.04 on x86/x64</p></li>
<li><p>Microsoft / Windows Server 2022 on x86/x64</p></li>
<li><p>Apple / macOS Monterey 12 on x86/x64</p></li>
</ul>
<p>If you deploy PyPEEC on computing nodes, GUI libraries (Matplotlib, PyVistaQt, PyQt5) are not required.
If you want to use PyPEEC with Jupyter, PyVista has to be installed with the optional Trame support.</p>
</section>
<section id="fft-accelerated-peec-method">
<h2>FFT-Accelerated PEEC Method<a class="headerlink" href="#fft-accelerated-peec-method" title="Permalink to this heading"></a></h2>
<p>There are two main categories of field simulation methods:</p>
<ul class="simple">
<li><p>Differential equation based method (FEM, FVM, FD, etc.)</p></li>
<li><p>Integral equation based method (MoM, BEM, PEEC, etc.)</p></li>
</ul>
<p>The PEEC method is an integral equation method. The fundamental ideal is to represent
the field simulation problem with a very large distributed equivalent circuit consisting
of resistances, self-inductances, mutual inductances, and capacitances.</p>
<p>This PEEC method feature several advantanges:</p>
<ul class="simple">
<li><p>Only the active materials are meshed (no need to mesh the free-space).</p></li>
<li><p>Intuitive understanding of the equation discretization process.</p></li>
<li><p>Straightforward connection of external circuit elements.</p></li>
</ul>
<p>The fundamental drawback of the PEEC method is that the matrix describing the
equation system is not sparse. This means that the computational cost and the
memory requirements of the problem is becoming problematic for large systems.</p>
<p>This problem can be mitigated if the geometry is represented with a voxel structure.
In this case, the dense matrices are block-Toeplitz Toeplitz-block matrices.
Such matrices can be embedded into circulant tensors reducing the memory requirements
from O(n^2) to 0(n). Additionally, the matrix-vector multiplications can be done
with Fourier transforms. With an FFT algorithm, the computational complexity of
matrix-vector multiplications is reduced from O(n^2) to 0(n*log(n)). Besides the reduced
computational cost and memory requirement, the FFTs allows for the usage of heavily
optimized libraries leveraging the parallel processing capabilities of CPUs or GPUs.</p>
<p>Here are some interesting papers about the PEEC method:</p>
<ul class="simple">
<li><ol class="upperalpha simple">
<li><p>Ruehli IEEE TMTT, 10.1109/TMTT.1974.1128204, 1974</p></li>
</ol>
</li>
<li><ol class="upperalpha simple" start="18">
<li><p>Torchio, IEEE TAP, 10.1109/TAP.2019.2927789, 2019</p></li>
</ol>
</li>
<li><ol class="upperalpha simple" start="18">
<li><p>Torchio, IEEE TPEL, 10.1109/TPEL.2021.3092431, 2022</p></li>
</ol>
</li>
</ul>
</section>
<section id="numerical-optimization">
<h2>Numerical Optimization<a class="headerlink" href="#numerical-optimization" title="Permalink to this heading"></a></h2>
<p>The code is reasonably optimized, leveraging NumPy and SciPy for the heavy operations.
All the code is vectorized, no loops are used for the array operations.
Sparse matrix algebra is used wherever appropriate to speed up the code and limit the memory consumption.
Wherever possible, multithreading/multiprocessing is used for exploiting multicore CPUs.</p>
<p>The following optimizations are available for the computationally heavy operations:</p>
<ul>
<li><p>Computation of the Green functions and electric-magnetic coupling functions.</p>
<ul class="simple">
<li><p>If the distance between the considered voxels is small, an analytical solution is used.</p></li>
<li><p>If the distance between the considered voxels is large, a numerical approximation is used.</p></li>
</ul>
</li>
<li><p>The factorization of the preconditioner sparse matrix can be done with several algorithms.</p>
<ul class="simple">
<li><p>SuperLU is typically slower but is always available (integrated with SciPy).</p></li>
<li><p>UMFPACK is typically faster than SuperLU (available through SciKits).</p></li>
<li><p>MKL/PARDISO is typically faster than UMFPACK (available through Pydiso).</p></li>
</ul>
</li>
<li><p>Two different iterative solvers are available for the dense matrices.</p>
<blockquote>
<div><ul class="simple">
<li><p>GMRES - Generalized Minimal RESidual algorithm</p></li>
<li><p>GCROT - Flexible GCROT(m,k) algorithm</p></li>
</ul>
</div></blockquote>
</li>
<li><p>The FFTs for computing matrix-vector product can be done with several algorithms.</p>
<ul class="simple">
<li><p>SciPy FFT library is always available (integrated with SciPy)</p></li>
<li><p>FFTW has to be installed separately (available through pyFFTW)</p></li>
<li><p>CuPy is extremely fast but require GPUs with the corresponding libraries (CUDA platform)</p></li>
</ul>
</li>
</ul>
</section>
<section id="configuration-file">
<h2>Configuration File<a class="headerlink" href="#configuration-file" title="Permalink to this heading"></a></h2>
<ul>
<li><p>The default configuration file is <code class="docutils literal notranslate"><span class="pre">pypeec/config.yaml</span></code>.</p>
<blockquote>
<div><ul class="simple">
<li><p>This file is always loaded first.</p></li>
<li><p>This file is included in the package.</p></li>
</ul>
</div></blockquote>
</li>
<li><p>The filename located the environment variable <code class="docutils literal notranslate"><span class="pre">PYPEEC</span></code> is loaded.</p>
<blockquote>
<div><ul class="simple">
<li><p>If the variable is not set, the default configuration is kept.</p></li>
<li><p>If the variable is is set, the default configuration is replaced.</p></li>
<li><p>This file can be in JSON or YAML formats.</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</section>
<section id="packaging-and-environment">
<h2>Packaging and Environment<a class="headerlink" href="#packaging-and-environment" title="Permalink to this heading"></a></h2>
<ul class="simple">
<li><p>A Python package can be built from the <code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code> and <code class="docutils literal notranslate"><span class="pre">setup.cfg</span></code> files.</p></li>
<li><p>In order to create a minimal Python Virtual Environment, use <code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code>.</p></li>
<li><p>In order to create a minimal Conda Environment, use <code class="docutils literal notranslate"><span class="pre">conda_base.yaml</span></code>.</p></li>
<li><p>In order to create a development environment, use <code class="docutils literal notranslate"><span class="pre">conda_dev.yaml</span></code>.</p></li>
</ul>
</section>
<section id="automated-tests">
<h2>Automated Tests<a class="headerlink" href="#automated-tests" title="Permalink to this heading"></a></h2>
<ul class="simple">
<li><p>The tests are located in the <code class="docutils literal notranslate"><span class="pre">tests</span></code> folder (using the <code class="docutils literal notranslate"><span class="pre">unittest</span></code> framework).</p></li>
<li><p>The shell script <code class="docutils literal notranslate"><span class="pre">run_tests.sh</span></code> is used to run the tests.</p></li>
<li><p>The tests are checking that the examples are running correctly.</p></li>
<li><p>Only integration tests currently exist (no unit tests).</p></li>
</ul>
</section>
<section id="sphinx-documentation">
<h2>Sphinx Documentation<a class="headerlink" href="#sphinx-documentation" title="Permalink to this heading"></a></h2>
<ul class="simple">
<li><p>The documentation is located in the <code class="docutils literal notranslate"><span class="pre">docs</span></code> folder (using the <code class="docutils literal notranslate"><span class="pre">Sphinx</span></code> generator).</p></li>
<li><p>The shell script <code class="docutils literal notranslate"><span class="pre">run_docs.sh</span></code> is used to build the HTML documentation.</p></li>
</ul>
</section>
<section id="pypeec-warnings">
<h2>PyPEEC Warnings<a class="headerlink" href="#pypeec-warnings" title="Permalink to this heading"></a></h2>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>For problems with <strong>magnetic domains</strong>, the <strong>preconditioner</strong> is not optimal.
This might lead to a slow convergence of the iterative matrix solver.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>For <strong>large problems</strong>, the code might allocate huge amounts of <strong>memory</strong>.
This might crash the program and/or your operating system.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>During the <strong>voxelization</strong> process, the same voxel can be assigned to several domains.
The problem is solved with used-provided <strong>conflict</strong> resolution rules between the domains.</p>
</div>
</section>
<section id="library-warnings">
<h2>Library Warnings<a class="headerlink" href="#library-warnings" title="Permalink to this heading"></a></h2>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The <strong>plotting code</strong> is probably sensitive to the environment (platform and the version of the libraries).
Therefore, these dependencies are minimized and insulated from the rest of the code.
The plotting code (viewer and plotter) is separated from the simulation code (mesher and solver).</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p><strong>Jupyter</strong> is not included in the package dependencies.
For Jupyter, PyVista has to be installed with the optional Trame support.
Jupyter support is optional, PyPEEC is fully functional without Jupyter.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The <strong>GPU libraries</strong> (CuPy and CUDA) are not included in the package dependencies.
The GPU support is extremely hardware/platform/version dependent.
GPU support is optional, PyPEEC is fully functional without GPU support.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p><strong>FFTW, UMFPACK, and MKL/PARDISO</strong> are not included in the package dependencies.
These libraries can be tricky to install, especially on MS Windows.
Make sure that these libraries are compiled with multithreading support.
FFTW, UMFPACK, and MKL/PARDISO are optional, PyPEEC is fully functional without them.</p>
</div>
</section>
<section id="general-warnings">
<h2>General Warnings<a class="headerlink" href="#general-warnings" title="Permalink to this heading"></a></h2>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Python <strong>Pickle files</strong> are using to store the mesher and solver results.
Pickling data is not secure.
Only load Pickle files that you trust.
Do not commit the Pickle files in the Git repository.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The <strong>dependencies</strong> are under <strong>various licences</strong> (including copyleft and proprietary).
Make sure to respect these licenses if you package and/or distribute these libraries.
Qt is under a copyleft license (LGPL and GPL).
FFTW is under a copyleft license (GPL).
MKL/PARDISO is a proprietary library (ISSL).</p>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="examples.html" class="btn btn-neutral float-left" title="Included Examples" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="format.html" class="btn btn-neutral float-right" title="File Formats" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright Thomas Guillod.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>